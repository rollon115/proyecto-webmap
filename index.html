<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viaje Pirineos 2025 - 4 Dias de Aventura</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/lucide@0.460.0/dist/umd/lucide.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #0f172a;
            --bg-card: rgba(30, 41, 59, 0.7);
            --bg-card-solid: #1e293b;
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --glass-bg: rgba(30, 41, 59, 0.6);
            --glass-border: rgba(255, 255, 255, 0.08);
            --radius: 16px;
            --radius-sm: 8px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .bg-gradient {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(99,102,241,0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(16,185,129,0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(245,158,11,0.05) 0%, transparent 50%);
            z-index: -1;
        }
        .header {
            position: fixed; top: 16px; left: 16px; right: 16px; z-index: 1000;
            background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: var(--radius);
            padding: 16px 24px; display: flex; justify-content: space-between; align-items: center;
        }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
        }
        .logo-text h1 {
            font-family: 'Playfair Display', serif; font-size: 1.4rem; font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--primary-light));
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
        }
        .logo-text span { font-size: 0.75rem; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; }
        .header-dates { display: flex; align-items: center; gap: 8px; color: var(--text-secondary); font-size: 0.9rem; }
        .header-dates i { width: 18px; height: 18px; color: var(--accent); }
        .main-container {
            padding: 100px 16px 16px; display: grid;
            grid-template-columns: 1fr 350px; gap: 16px; min-height: 100vh;
        }
        .map-section {
            grid-row: 1 / 3;
            background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: var(--radius);
            overflow: hidden; position: relative;
        }
        .map-header {
            position: absolute; top: 16px; left: 16px; right: 16px; z-index: 500;
            display: flex; gap: 12px; flex-wrap: wrap;
        }
        .map-badge {
            background: var(--glass-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border); border-radius: 20px;
            padding: 8px 16px; display: flex; align-items: center; gap: 8px;
            font-size: 0.85rem; color: var(--text-secondary);
        }
        .map-badge.active { background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; border-color: transparent; }
        .map-badge i { width: 16px; height: 16px; }
        #map { width: 100%; height: 100%; min-height: 500px; }
        .custom-marker {
            width: 36px; height: 36px; border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg); display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 12px rgba(99,102,241,0.4); border: 3px solid white;
        }
        .custom-marker svg { transform: rotate(45deg); }
        .leaflet-popup-content-wrapper {
            background: var(--bg-card-solid); border: 1px solid var(--glass-border); border-radius: var(--radius-sm);
        }
        .leaflet-popup-content { color: var(--text-primary); font-family: 'Inter', sans-serif; margin: 12px 16px; }
        .leaflet-popup-content h3 { font-size: 1rem; font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .leaflet-popup-content p { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5; }
        .popup-tag {
            display: inline-block; background: rgba(99,102,241,0.2); color: var(--primary-light);
            padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; margin-top: 8px;
        }
        .side-panel { display: flex; flex-direction: column; gap: 16px; overflow-y: auto; max-height: calc(100vh - 116px); }
        .card {
            background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: var(--radius); padding: 20px;
        }
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
        .card-title { display: flex; align-items: center; gap: 10px; font-size: 1rem; font-weight: 600; }
        .card-title i { width: 20px; height: 20px; color: var(--primary-light); }
        .card-badge {
            background: rgba(16,185,129,0.2); color: var(--secondary);
            padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 500;
        }
        .weather-main { display: flex; align-items: center; gap: 20px; margin-bottom: 16px; }
        .weather-icon { width: 64px; height: 64px; display: flex; align-items: center; justify-content: center; }
        .weather-info h2 { font-size: 2.2rem; font-weight: 700; line-height: 1; }
        .weather-info p { margin: 0; }
        .weather-location { display: flex; align-items: center; gap: 6px; color: var(--text-muted); font-size: 0.85rem; margin-top: 4px; }
        .weather-location i { width: 14px; height: 14px; color: var(--accent); }
        .weather-details { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 16px; }
        .weather-detail { text-align: center; padding: 10px 6px; background: rgba(255,255,255,0.03); border-radius: var(--radius-sm); }
        .weather-detail i { width: 16px; height: 16px; color: var(--text-muted); margin-bottom: 4px; }
        .weather-detail .value { font-size: 1rem; font-weight: 600; display: block; }
        .weather-detail .label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .forecast-section { border-top: 1px solid var(--glass-border); padding-top: 14px; }
        .forecast-title { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; font-weight: 600; }
        .forecast-days { display: flex; gap: 8px; }
        .forecast-day {
            flex: 1; text-align: center; padding: 10px 6px;
            background: rgba(255,255,255,0.03); border-radius: var(--radius-sm);
        }
        .forecast-day .day-name { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 6px; }
        .forecast-day .day-icon { width: 32px; height: 32px; margin: 0 auto 6px; }
        .forecast-day .day-temps { font-size: 0.8rem; }
        .forecast-day .day-max { font-weight: 600; color: var(--text-primary); }
        .forecast-day .day-min { color: var(--text-muted); }
        .traffic-routes { display: flex; flex-direction: column; gap: 8px; }
        .route-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px; background: rgba(255,255,255,0.03); border-radius: var(--radius-sm);
            cursor: pointer; transition: all 0.2s; border: 1px solid transparent;
        }
        .route-item:hover { background: rgba(255,255,255,0.06); border-color: var(--glass-border); }
        .route-item.active { background: rgba(99,102,241,0.15); border-color: var(--primary); }
        .route-name { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; }
        .route-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .route-time { font-weight: 600; color: var(--secondary); font-size: 0.85rem; }
        .route-detail-panel {
            margin-top: 12px; padding: 16px;
            background: rgba(99,102,241,0.08); border: 1px solid rgba(99,102,241,0.2);
            border-radius: var(--radius-sm); display: none;
        }
        .route-detail-panel.visible { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: translateY(0); } }
        .route-detail-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .route-detail-header h4 { font-size: 0.95rem; font-weight: 600; color: var(--primary-light); }
        .route-detail-close {
            background: none; border: none; color: var(--text-muted); cursor: pointer;
            width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem;
        }
        .route-detail-close:hover { color: var(--text-primary); }
        .route-detail-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px; }
        .route-stat {
            text-align: center; padding: 10px;
            background: rgba(255,255,255,0.05); border-radius: var(--radius-sm);
        }
        .route-stat .stat-value { font-size: 1.2rem; font-weight: 700; display: block; }
        .route-stat .stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; }
        .route-stat.km .stat-value { color: var(--primary-light); }
        .route-stat.time .stat-value { color: var(--secondary); }
        .route-weather-mini {
            display: flex; align-items: center; gap: 12px; padding: 10px;
            background: rgba(245,158,11,0.1); border-radius: var(--radius-sm);
        }
        .route-weather-mini .rw-icon { width: 36px; height: 36px; flex-shrink: 0; }
        .route-weather-mini .rw-info { flex: 1; }
        .route-weather-mini .rw-temp { font-size: 1.1rem; font-weight: 700; }
        .route-weather-mini .rw-desc { font-size: 0.8rem; color: var(--text-secondary); }
        .route-weather-mini .rw-label { font-size: 0.7rem; color: var(--text-muted); }
        .poi-list { display: flex; flex-direction: column; gap: 8px; }
        .poi-item {
            display: flex; align-items: center; gap: 12px; padding: 10px;
            background: rgba(255,255,255,0.03); border-radius: var(--radius-sm);
            cursor: pointer; transition: all 0.2s;
        }
        .poi-item:hover { background: rgba(255,255,255,0.06); transform: translateX(4px); }
        .poi-marker {
            width: 36px; height: 36px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .poi-marker i { width: 18px; height: 18px; color: white; }
        .poi-info { flex: 1; }
        .poi-info h4 { font-size: 0.9rem; font-weight: 600; margin-bottom: 2px; }
        .poi-info p { font-size: 0.75rem; color: var(--text-muted); }
        .poi-day {
            font-size: 0.7rem; background: rgba(99,102,241,0.2); color: var(--primary-light);
            padding: 3px 8px; border-radius: 12px; font-weight: 500; white-space: nowrap;
        }
        .loading-spinner {
            width: 24px; height: 24px; border: 2px solid var(--glass-border);
            border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 3px; }
        .detail-modal {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            z-index: 2000; display: none; align-items: center; justify-content: center;
            padding: 20px; overflow-y: auto;
        }
        .detail-modal.active { display: flex; }
        .detail-content {
            background: var(--bg-card-solid); border: 1px solid var(--glass-border);
            border-radius: var(--radius); max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto;
        }
        .detail-header {
            position: sticky; top: 0; padding: 24px;
            display: flex; justify-content: space-between; align-items: center; z-index: 10;
        }
        .detail-header h2 { font-family: 'Playfair Display', serif; font-size: 1.8rem; color: white; }
        .detail-close {
            background: rgba(255,255,255,0.2); border: none; color: white;
            width: 40px; height: 40px; border-radius: 50%; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        .detail-close:hover { background: rgba(255,255,255,0.3); }
        .detail-body { padding: 24px; }
        .detail-section { margin-bottom: 24px; }
        .detail-section h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 12px; color: var(--primary-light); }
        .detail-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
        .detail-card { background: rgba(255,255,255,0.05); border-radius: var(--radius-sm); padding: 16px; }
        .detail-card.highlight { background: linear-gradient(135deg, rgba(16,185,129,0.2), rgba(16,185,129,0.1)); border: 1px solid rgba(16,185,129,0.3); }
        .detail-card h4 { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 8px; }
        .detail-card .price { font-size: 1.5rem; font-weight: 700; color: var(--secondary); }
        .detail-card .price span { font-size: 0.9rem; font-weight: 400; color: var(--text-muted); }
        .detail-card p { font-size: 0.85rem; color: var(--text-secondary); margin-top: 8px; }
        .detail-list { list-style: none; display: flex; flex-direction: column; gap: 8px; }
        .detail-list li { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--glass-border); }
        .detail-list li:last-child { border-bottom: none; }
        .detail-list .label { color: var(--text-secondary); font-size: 0.85rem; }
        .detail-list .value { font-weight: 600; }
        .detail-weather {
            display: flex; gap: 20px; align-items: center;
            background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(245,158,11,0.1));
            border-radius: var(--radius-sm); padding: 16px;
        }
        .detail-weather-icon { width: 40px; height: 40px; }
        .detail-weather-info h4 { font-size: 2rem; font-weight: 700; }
        .beginner-badge {
            font-size: 0.7rem; padding: 4px 10px; border-radius: 12px;
            background: linear-gradient(135deg, var(--accent), #fbbf24); color: #1e293b; font-weight: 700;
        }
        .beginner-tips { background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.2); border-radius: var(--radius-sm); padding: 16px; }
        .beginner-tips h4 { font-size: 0.9rem; margin-bottom: 10px; color: var(--accent); }
        .beginner-tips ul { padding-left: 20px; }
        .beginner-tips li { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 6px; line-height: 1.5; }
        .detail-links { display: flex; gap: 12px; flex-wrap: wrap; }
        .detail-link {
            display: inline-flex; align-items: center; gap: 8px;
            background: var(--primary); color: white; padding: 10px 16px;
            border-radius: 8px; text-decoration: none; font-size: 0.85rem; font-weight: 500;
        }
        .popup-details { margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--glass-border); }
        .popup-details h4 { font-size: 0.8rem; font-weight: 600; margin-bottom: 8px; }
        .pistas-grid { display: grid; gap: 4px; }
        .pista { font-size: 0.75rem; padding: 4px 8px; border-radius: 4px; background: rgba(255,255,255,0.05); }
        .zonas-list { display: flex; flex-wrap: wrap; gap: 6px; }
        .zona-tag { font-size: 0.7rem; padding: 3px 8px; border-radius: 12px; background: rgba(139,92,246,0.2); color: #a78bfa; }
        @media (max-width: 1024px) {
            .main-container { grid-template-columns: 1fr; }
            .map-section { grid-row: auto; min-height: 400px; }
            .side-panel { max-height: none; }
        }
        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 12px; text-align: center; }
            .forecast-days { flex-wrap: wrap; }
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>

    <header class="header">
        <div class="logo">
            <div class="logo-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M2 12h20"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                </svg>
            </div>
            <div class="logo-text">
                <h1>Viaje Pirineos</h1>
                <span>4 Dias de Aventura</span>
            </div>
        </div>
        <div class="header-dates">
            <i data-lucide="calendar"></i>
            <span>14 - 17 Febrero 2025</span>
        </div>
    </header>

    <main class="main-container">
        <section class="map-section">
            <div class="map-header">
                <div class="map-badge active">
                    <i data-lucide="map-pin"></i>
                    <span>6 Destinos</span>
                </div>
                <div class="map-badge">
                    <i data-lucide="route"></i>
                    <span>5 Rutas</span>
                </div>
                <div class="map-badge">
                    <i data-lucide="mountain"></i>
                    <span>Palencia - Pirineos - Toulouse</span>
                </div>
            </div>
            <div id="map"></div>
        </section>

        <aside class="side-panel">
            <!-- Weather Card - Lourdes -->
            <div class="card" id="weather-card">
                <div class="card-header">
                    <div class="card-title">
                        <i data-lucide="cloud-sun"></i>
                        <span>El Tiempo</span>
                    </div>
                    <span class="card-badge">En vivo</span>
                </div>
                <div class="weather-main">
                    <div class="weather-icon" id="weather-icon">
                        <div class="loading-spinner"></div>
                    </div>
                    <div class="weather-info">
                        <h2 id="weather-temp">--¬∞</h2>
                        <p id="weather-desc">Cargando...</p>
                        <div class="weather-location">
                            <i data-lucide="map-pin"></i>
                            <span>Lourdes, Francia</span>
                        </div>
                    </div>
                </div>
                <div class="weather-details">
                    <div class="weather-detail">
                        <i data-lucide="droplets"></i>
                        <span class="value" id="weather-humidity">--%</span>
                        <span class="label">Humedad</span>
                    </div>
                    <div class="weather-detail">
                        <i data-lucide="wind"></i>
                        <span class="value" id="weather-wind">-- km/h</span>
                        <span class="label">Viento</span>
                    </div>
                    <div class="weather-detail">
                        <i data-lucide="thermometer"></i>
                        <span class="value" id="weather-feels">--¬∞</span>
                        <span class="label">Sensaci√≥n</span>
                    </div>
                </div>
                <div class="forecast-section">
                    <div class="forecast-title">Pron√≥stico 3 d√≠as</div>
                    <div class="forecast-days" id="forecast-days">
                        <div class="forecast-day"><div class="day-name">--</div><div class="day-icon"><div class="loading-spinner" style="width:20px;height:20px;"></div></div><div class="day-temps">--</div></div>
                        <div class="forecast-day"><div class="day-name">--</div><div class="day-icon"><div class="loading-spinner" style="width:20px;height:20px;"></div></div><div class="day-temps">--</div></div>
                        <div class="forecast-day"><div class="day-name">--</div><div class="day-icon"><div class="loading-spinner" style="width:20px;height:20px;"></div></div><div class="day-temps">--</div></div>
                    </div>
                </div>
            </div>

            <!-- Traffic / Routes Card -->
            <div class="card" id="traffic-card">
                <div class="card-header">
                    <div class="card-title">
                        <i data-lucide="navigation"></i>
                        <span>Rutas</span>
                    </div>
                    <span class="card-badge">5 trayectos</span>
                </div>
                <div class="traffic-routes" id="traffic-routes">
                    <div class="route-item" data-route="guardo-biarritz" onclick="showRouteDetail('guardo-biarritz')">
                        <div class="route-name">
                            <div class="route-dot" style="background: #10b981;"></div>
                            <span>Guardo ‚Üí Biarritz</span>
                        </div>
                        <span class="route-time" id="rt-guardo-biarritz">...</span>
                    </div>
                    <div class="route-item" data-route="biarritz-lourdes" onclick="showRouteDetail('biarritz-lourdes')">
                        <div class="route-name">
                            <div class="route-dot" style="background: #3b82f6;"></div>
                            <span>Biarritz ‚Üí Lourdes</span>
                        </div>
                        <span class="route-time" id="rt-biarritz-lourdes">...</span>
                    </div>
                    <div class="route-item" data-route="lourdes-cauterets" onclick="showRouteDetail('lourdes-cauterets')">
                        <div class="route-name">
                            <div class="route-dot" style="background: #8b5cf6;"></div>
                            <span>Lourdes ‚Üí Cauterets</span>
                        </div>
                        <span class="route-time" id="rt-lourdes-cauterets">...</span>
                    </div>
                    <div class="route-item" data-route="lourdes-toulouse" onclick="showRouteDetail('lourdes-toulouse')">
                        <div class="route-name">
                            <div class="route-dot" style="background: #f59e0b;"></div>
                            <span>Lourdes ‚Üí Toulouse</span>
                        </div>
                        <span class="route-time" id="rt-lourdes-toulouse">...</span>
                    </div>
                    <div class="route-item" data-route="lourdes-pau" onclick="showRouteDetail('lourdes-pau')">
                        <div class="route-name">
                            <div class="route-dot" style="background: #ec4899;"></div>
                            <span>Lourdes ‚Üí Pau</span>
                        </div>
                        <span class="route-time" id="rt-lourdes-pau">...</span>
                    </div>
                </div>
                <div class="route-detail-panel" id="route-detail-panel">
                    <div class="route-detail-header">
                        <h4 id="rd-title">--</h4>
                        <button class="route-detail-close" onclick="closeRouteDetail()">‚úï</button>
                    </div>
                    <div class="route-detail-stats">
                        <div class="route-stat km">
                            <span class="stat-value" id="rd-km">--</span>
                            <span class="stat-label">Kil√≥metros</span>
                        </div>
                        <div class="route-stat time">
                            <span class="stat-value" id="rd-time">--</span>
                            <span class="stat-label">Duraci√≥n</span>
                        </div>
                    </div>
                    <div class="route-weather-mini" id="rd-weather">
                        <div class="rw-icon" id="rd-weather-icon"><div class="loading-spinner" style="width:20px;height:20px;"></div></div>
                        <div class="rw-info">
                            <div class="rw-label">Tiempo en destino</div>
                            <span class="rw-temp" id="rd-weather-temp">--¬∞</span>
                            <span class="rw-desc" id="rd-weather-desc">Cargando...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- POI Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i data-lucide="star"></i>
                        <span>Puntos de Inter√©s</span>
                    </div>
                </div>
                <div class="poi-list">
                    <div class="poi-item" onclick="flyToPOI('guardo')">
                        <div class="poi-marker" style="background: linear-gradient(135deg, #10b981, #34d399);"><i data-lucide="home"></i></div>
                        <div class="poi-info"><h4>Guardo</h4><p>Punto de encuentro</p></div>
                        <span class="poi-day">D√≠a 1</span>
                    </div>
                    <div class="poi-item" onclick="flyToPOI('biarritz')">
                        <div class="poi-marker" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);"><i data-lucide="waves"></i></div>
                        <div class="poi-info"><h4>Biarritz</h4><p>Playa y glamour</p></div>
                        <span class="poi-day">D√≠a 1</span>
                    </div>
                    <div class="poi-item" onclick="flyToPOI('lourdes')">
                        <div class="poi-marker" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);"><i data-lucide="church"></i></div>
                        <div class="poi-info"><h4>Lourdes</h4><p>Santuario mundial</p></div>
                        <span class="poi-day">D√≠a 2</span>
                    </div>
                    <div class="poi-item" onclick="flyToPOI('cauterets')">
                        <div class="poi-marker" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);"><i data-lucide="mountain-snow"></i></div>
                        <div class="poi-info"><h4>Cauterets</h4><p>Estaci√≥n de esqu√≠</p></div>
                        <span class="poi-day">D√≠a 3</span>
                    </div>
                    <div class="poi-item" onclick="flyToPOI('betharram')">
                        <div class="poi-marker" style="background: linear-gradient(135deg, #14b8a6, #2dd4bf);"><i data-lucide="gem"></i></div>
                        <div class="poi-info"><h4>B√©tharram</h4><p>Grutas subterr√°neas</p></div>
                        <span class="poi-day">D√≠a 2</span>
                    </div>
                    <div class="poi-item" onclick="flyToPOI('toulouse')">
                        <div class="poi-marker" style="background: linear-gradient(135deg, #ef4444, #f87171);"><i data-lucide="rocket"></i></div>
                        <div class="poi-info"><h4>Toulouse</h4><p>Cit√© de l'Espace</p></div>
                        <span class="poi-day">D√≠a 3</span>
                    </div>
                    <div class="poi-item" onclick="flyToPOI('pau')">
                        <div class="poi-marker" style="background: linear-gradient(135deg, #ec4899, #f472b6);"><i data-lucide="landmark"></i></div>
                        <div class="poi-info"><h4>Pau</h4><p>Historia y cultura</p></div>
                        <span class="poi-day">D√≠a 4</span>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Lourdes Detail Modal -->
    <div class="detail-modal" id="lourdes-modal">
        <div class="detail-content">
            <div class="detail-header" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">
                <h2>Lourdes - Qu√© Ver y D√≥nde Comer</h2>
                <button class="detail-close" onclick="closeLourdesModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="detail-body">
                <div class="detail-section">
                    <h3>‚õ™ Santuario de Nuestra Se√±ora de Lourdes</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 12px;">Lugar de peregrinaci√≥n mundial donde la Virgen Mar√≠a se apareci√≥ a <strong>Bernardita Soubirous</strong> en 1858. Acceso <strong>gratuito</strong> todo el a√±o.</p>
                    <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 10px;">
                        <div class="detail-card" style="border-left: 3px solid #f59e0b;">
                            <h4>‚úã Tocar la Roca de la Gruta</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Gruta de Massabielle, lugar de las apariciones. Acceso libre.</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid #ef4444;">
                            <h4>üïØÔ∏è Encender una Vela</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Explanada de velas frente a la Gruta. Velas disponibles en el recinto.</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid #3b82f6;">
                            <h4>üíß Beber Agua del Manantial</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Fuentes con agua del manantial descubierto por Bernardita. Gratuito.</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid #8b5cf6;">
                            <h4>üî• Procesi√≥n de las Antorchas</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Cada noche a las 21:00 (temporada de peregrinaci√≥n). Experiencia √∫nica.</p>
                        </div>
                    </div>
                    <div style="margin-top: 12px; text-align: center;">
                        <a href="https://www.lourdes-france.com/es/" target="_blank" class="detail-link" style="background: linear-gradient(135deg, #f59e0b, #fbbf24); color: #1e293b;">‚õ™ Web Oficial del Santuario</a>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üè∞ Ch√¢teau Fort - Mus√©e Pyr√©n√©en</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 12px;">Fortaleza medieval que vigila Lourdes desde la Edad Media. Ha sido residencia de condes, fortaleza militar y prisi√≥n real. Alberga el <strong>Museo Pirenaico</strong> (fundado en 1921) con colecci√≥n etnogr√°fica y de bellas artes. <strong>Vistas panor√°micas</strong> excepcionales de la ciudad, el Santuario y los Pirineos. Jard√≠n bot√°nico con esculturas.</p>
                </div>
                <div class="detail-section">
                    <h3>üïê Horarios Castillo</h3>
                    <ul class="detail-list">
                        <li><span class="label">Lun - Dom</span><span class="value">10:00-12:00 / 14:00-17:00</span></li>
                        <li><span class="label">Duraci√≥n visita</span><span class="value">1h - 3h seg√∫n modalidad</span></li>
                    </ul>
                    <div style="margin-top: 10px; padding: 10px; background: rgba(245,158,11,0.1); border-radius: var(--radius-sm); font-size: 0.85rem; color: var(--text-secondary);">üí° Se recomienda <strong>reservar online</strong>. Se admiten mascotas y tiene acceso para personas con movilidad reducida.</div>
                </div>
                <div class="detail-section">
                    <h3>üí∞ Precios Castillo</h3>
                    <div class="detail-grid">
                        <div class="detail-card"><h4>AUTOGUIADA</h4><div class="price">8‚Ç¨</div><p>A tu ritmo con folleto</p></div>
                        <div class="detail-card highlight"><h4>VISITA GUIADA</h4><div class="price">9‚Ç¨</div><p>1h15 min con gu√≠a (franc√©s)</p></div>
                        <div class="detail-card"><h4>PACK FAMILIA</h4><div class="price">18‚Ç¨</div><p>Visita libre familiar</p></div>
                        <div class="detail-card"><h4>GRUPO (+15)</h4><div class="price">6‚Ç¨</div><p>Por persona, autoguiada</p></div>
                    </div>
                    <div style="margin-top: 12px; text-align: center;">
                        <a href="https://www.chateaufort-lourdes.fr/es-ES/reservas-en-linea.html" target="_blank" class="detail-link" style="background: linear-gradient(135deg, #f59e0b, #fbbf24); color: #1e293b;">üéüÔ∏è Reservar Entradas Online</a>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>‚òï D√≥nde Desayunar</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div class="detail-card" style="border-left: 3px solid #f59e0b;">
                            <h4>ü•ê La Pie Colette</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Panader√≠a-caf√© artesanal en el centro de Lourdes. Ideal para desayunar con boller√≠a francesa, caf√© y productos locales antes de visitar el Santuario o el Castillo.</p>
                            <div style="margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap;">
                                <a href="https://maps.app.goo.gl/ATRUPD6S4m9yNGt78" target="_blank" class="detail-link" style="padding: 8px 14px; font-size: 0.85rem;">üìç Ver en Google Maps</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üöó C√≥mo Llegar al Castillo</h3>
                    <ul class="detail-list">
                        <li><span class="label">Direcci√≥n</span><span class="value">25 Rue Du Fort, 65100 Lourdes</span></li>
                        <li><span class="label">Tel√©fono</span><span class="value">+33 5 62 42 37 37</span></li>
                    </ul>
                </div>
                <div class="detail-section">
                    <h3>üå§Ô∏è Tiempo en Lourdes</h3>
                    <div class="detail-weather">
                        <div class="detail-weather-icon" id="lourdes-weather-icon"><div class="loading-spinner"></div></div>
                        <div class="detail-weather-info">
                            <h4 id="lourdes-temp">--¬∞C</h4>
                            <p id="lourdes-condition">Cargando...</p>
                        </div>
                        <div style="margin-left: auto; text-align: right;">
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Viento: <span id="lourdes-wind">-- km/h</span></p>
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Humedad: <span id="lourdes-humidity">--%</span></p>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üîó Enlaces √ötiles</h3>
                    <div class="detail-links">
                        <a href="https://www.lourdes-france.com/es/" target="_blank" class="detail-link" style="background: linear-gradient(135deg, #f59e0b, #fbbf24); color: #1e293b;">‚õ™ Santuario Web</a>
                        <a href="https://www.chateaufort-lourdes.fr/es-ES/" target="_blank" class="detail-link">üè∞ Castillo</a>
                        <a href="https://maps.app.goo.gl/ATRUPD6S4m9yNGt78" target="_blank" class="detail-link" style="background: var(--secondary);">ü•ê La Pie Colette</a>
                        <a href="https://www.lourdes-france.com/es/peregrino-por-un-dia/" target="_blank" class="detail-link" style="background: var(--accent); color: #1e293b;">üìç Preparar Visita</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cauterets Detail Modal -->
    <div class="detail-modal" id="cauterets-modal">
        <div class="detail-content">
            <div class="detail-header" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">
                <h2>Cauterets - Estaci√≥n de Esqu√≠</h2>
                <button class="detail-close" onclick="closeCauteretsModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="detail-body">
                <div class="detail-section">
                    <h3>üå§Ô∏è Tiempo en la Estaci√≥n</h3>
                    <div class="detail-weather">
                        <div class="detail-weather-icon" id="cauterets-weather-icon"><div class="loading-spinner"></div></div>
                        <div class="detail-weather-info">
                            <h4 id="cauterets-temp">--¬∞C</h4>
                            <p id="cauterets-condition">Cargando...</p>
                        </div>
                        <div style="margin-left: auto; text-align: right;">
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Viento: <span id="cauterets-wind">-- km/h</span></p>
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Humedad: <span id="cauterets-humidity">--%</span></p>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üó∫Ô∏è Plano de Pistas 2024-25</h3>
                    <div style="border-radius: var(--radius-sm); overflow: hidden; background: rgba(255,255,255,0.05);">
                        <a href="https://www.cauterets.com/app/uploads/2024/12/PLAN-PISTES-HIVER-CAUTERETS-24-25-WEB-1.pdf" target="_blank" style="display: block;">
                            <img src="https://www.cauterets.com/app/uploads/2024/12/PLAN-PISTES-HIVER-CAUTERETS-24-25-WEB-1-2048x1451.jpg" alt="Plano de pistas Cauterets" style="width: 100%; height: auto; display: block;">
                        </a>
                        <div style="padding: 16px; text-align: center; background: rgba(0,0,0,0.3); display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                            <a href="https://www.cauterets.com/app/uploads/2024/12/PLAN-PISTES-HIVER-CAUTERETS-24-25-WEB-1.pdf" target="_blank" style="background: var(--secondary); color: white; padding: 12px 20px; border-radius: 10px; text-decoration: none; font-weight: 600;">üìÑ Ver PDF</a>
                            <a href="https://www.n-py.com/fr/cauterets/plan-des-pistes" target="_blank" style="background: var(--primary); color: white; padding: 12px 20px; border-radius: 10px; text-decoration: none; font-weight: 600;">üó∫Ô∏è Mapa Interactivo</a>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>‚úÖ Para Principiantes <span class="beginner-badge">‚≠ê RECOMENDADO</span></h3>
                    <div class="beginner-tips">
                        <h4>üí° Consejos para tu primer d√≠a</h4>
                        <ul>
                            <li>Empieza en las <strong>pistas de Yeti</strong> - son las m√°s suaves</li>
                            <li>El paquete principiante incluye <strong>telef√©rico + telesilla + 2 pistas verdes</strong></li>
                            <li>Alquila el equipo en el pueblo antes de subir - m√°s barato</li>
                            <li>Llega temprano (9:00) para evitar colas en el telef√©rico</li>
                            <li>Reserva clase con monitor si es tu primera vez</li>
                        </ul>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üí∞ Precios Forfait 2025</h3>
                    <div class="detail-grid">
                        <div class="detail-card highlight"><h4>PAQUETE PRINCIPIANTE</h4><div class="price">10‚Ç¨ <span>/d√≠a</span></div><p>Telef√©rico + telesilla Clot + 2 pistas verdes</p></div>
                        <div class="detail-card"><h4>Forfait 1 D√≠a</h4><div class="price">45‚Ç¨ <span>/d√≠a</span></div><p>Acceso completo</p></div>
                        <div class="detail-card"><h4>Forfait 2 D√≠as</h4><div class="price">85‚Ç¨ <span>/2 d√≠as</span></div><p>Mejor opci√≥n estancias largas</p></div>
                        <div class="detail-card"><h4>Forfait 4 D√≠as</h4><div class="price">140‚Ç¨ <span>/4 d√≠as</span></div><p>+ descuentos restaurantes</p></div>
                        <div class="detail-card"><h4>Solo Telef√©rico</h4><div class="price">8‚Ç¨ <span>/ida y vuelta</span></div><p>Billete subida</p></div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üö° Telef√©rico Pueblo - Estaci√≥n</h3>
                    <ul class="detail-list">
                        <li><span class="label">Distancia</span><span class="value">5 min desde parking</span></li>
                        <li><span class="label">Duraci√≥n trayecto</span><span class="value">~10 minutos</span></li>
                        <li><span class="label">Horario</span><span class="value">9:00 - 16:30</span></li>
                    </ul>
                </div>
                <div class="detail-section">
                    <h3>üÖøÔ∏è Parking Gratuito</h3>
                    <ul class="detail-list">
                        <li><span class="label">Ubicaci√≥n</span><span class="value">Parking du Tartas (gratuito)</span></li>
                        <li><span class="label">Desde el parking</span><span class="value">~5 min andando</span></li>
                        <li><span class="label">Horario</span><span class="value">7:00 - 19:00</span></li>
                    </ul>
                    <div style="margin-top: 12px;">
                        <a href="https://maps.app.goo.gl/nL74ftyVBR3QHYa18" target="_blank" class="detail-link">üìç Ver en Google Maps</a>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üîó Enlaces √ötiles</h3>
                    <div class="detail-links">
                        <a href="https://www.cauterets.com/es/esqui/como-elegir-su-forfait-de-invierno/" target="_blank" class="detail-link">üéø Web oficial - Forfaits</a>
                        <a href="tel:+33562925050" class="detail-link" style="background: var(--accent); color: #1e293b;">üìû Oficina Turismo</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toulouse Detail Modal -->
    <div class="detail-modal" id="toulouse-modal">
        <div class="detail-content">
            <div class="detail-header" style="background: linear-gradient(135deg, #ef4444, #f87171);">
                <h2>Toulouse - Cit√© de l'Espace</h2>
                <button class="detail-close" onclick="closeToulouseModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="detail-body">
                <div class="detail-section">
                    <h3>üöÄ Sobre la Cit√© de l'Espace</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 12px;">Parque tem√°tico dedicado al espacio y la conquista espacial. Replicas a tama√±o real del cohete Ariane 5, la estaci√≥n espacial MIR, planetario IMAX y exposiciones interactivas. ¬°Una experiencia √∫nica!</p>
                </div>
                <div class="detail-section">
                    <h3>üïê Horarios (Febrero 2026)</h3>
                    <ul class="detail-list">
                        <li><span class="label">Lun - Jue</span><span class="value">10:00 - 17:00</span></li>
                        <li><span class="label">Vie - Dom</span><span class="value">10:00 - 18:00</span></li>
                        <li><span class="label">Taquillas cierran</span><span class="value">1 hora antes</span></li>
                        <li><span class="label">‚ö†Ô∏è 1-5 Feb</span><span class="value" style="color: var(--danger);">Cerrado</span></li>
                    </ul>
                    <div style="margin-top: 10px; padding: 10px; background: rgba(245,158,11,0.1); border-radius: var(--radius-sm); font-size: 0.85rem; color: var(--text-secondary);">üí° Recomendamos dedicar al menos <strong>medio d√≠a</strong> a la visita. Se aconseja comprar entradas online.</div>
                </div>
                <div class="detail-section">
                    <h3>üí∞ Precios Entrada 1 D√≠a</h3>
                    <div class="detail-grid">
                        <div class="detail-card"><h4>ADULTO</h4><div class="price">29‚Ç¨</div><p>Tarifa normal</p></div>
                        <div class="detail-card highlight"><h4>NI√ëO / JOVEN</h4><div class="price">22,50‚Ç¨</div><p>De 5 a 18 a√±os</p></div>
                        <div class="detail-card"><h4>ESTUDIANTE</h4><div class="price">22,50‚Ç¨</div><p>Con carn√© de estudiante</p></div>
                        <div class="detail-card"><h4>MENOR DE 5</h4><div class="price" style="color: var(--accent);">GRATIS</div><p>Acceso gratuito</p></div>
                        <div class="detail-card"><h4>ADULTO REDUCIDA</h4><div class="price">26‚Ç¨</div><p>Desempleados / Discapacidad</p></div>
                        <div class="detail-card"><h4>PACK TRIBU</h4><div class="price">-1,50‚Ç¨ <span>/billete</span></div><p>De 4 a 6 entradas</p></div>
                    </div>
                    <div style="margin-top: 12px; text-align: center;">
                        <a href="https://billets.cite-espace.com/Exhibitions/Register?ID=71A7A846-C098-ED11-A2DD-B6A507C45F96" target="_blank" class="detail-link" style="background: linear-gradient(135deg, #ef4444, #f87171);">üéüÔ∏è Comprar Entradas Online</a>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üçΩÔ∏è D√≥nde Comer Dentro</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div class="detail-card" style="border-left: 3px solid var(--secondary);">
                            <h4>üç¥ Restaurante L'Astronaute</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Restaurante principal en los Jardines, bajo el hall de entrada. Men√∫ infantil disponible.</p>
                            <p style="color: var(--secondary); font-weight: 600; margin-top: 6px;">Cocina abierta hasta las 15:00</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid var(--primary-light);">
                            <h4>‚òï El 149 Caf√©</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Snack lounge de dise√±o en el Astralia. Solo fines de semana y vacaciones escolares.</p>
                            <p style="color: var(--primary-light); font-weight: 600; margin-top: 6px;">Cocina abierta hasta las 14:30</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid var(--accent);">
                            <h4>ü•ñ La Terrasse Guyanaise</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Bocadiller√≠a frente al cohete Ariane 5. Abierta solo en ciertos periodos (vacaciones, festivos).</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid var(--text-muted);">
                            <h4>üß∫ Zona Picnic</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">2 salas de picnic en los jardines, protegidas en caso de lluvia. Puedes traer tu propia comida.</p>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üöó C√≥mo Llegar</h3>
                    <ul class="detail-list">
                        <li><span class="label">Direcci√≥n</span><span class="value">Avenue Jean Gonord, Toulouse</span></li>
                        <li><span class="label">Transporte p√∫blico</span><span class="value">Bus Lineo L12 ‚Üí "Cit√© de l'espace"</span></li>
                        <li><span class="label">Parking</span><span class="value">Gratuito en el recinto</span></li>
                    </ul>
                    <div style="margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <a href="https://maps.app.goo.gl/3YB2vPdQc4Q5f8xNA" target="_blank" class="detail-link">üìç Ver en Google Maps</a>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üå§Ô∏è Tiempo en Toulouse</h3>
                    <div class="detail-weather">
                        <div class="detail-weather-icon" id="toulouse-weather-icon"><div class="loading-spinner"></div></div>
                        <div class="detail-weather-info">
                            <h4 id="toulouse-temp">--¬∞C</h4>
                            <p id="toulouse-condition">Cargando...</p>
                        </div>
                        <div style="margin-left: auto; text-align: right;">
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Viento: <span id="toulouse-wind">-- km/h</span></p>
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Humedad: <span id="toulouse-humidity">--%</span></p>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üîó Enlaces √ötiles</h3>
                    <div class="detail-links">
                        <a href="https://es.cite-espace.com/visitar/billetes/billete-1-dia/" target="_blank" class="detail-link" style="background: linear-gradient(135deg, #ef4444, #f87171);">üéüÔ∏è Billetes - Web Oficial</a>
                        <a href="https://es.cite-espace.com/visitar/horario/" target="_blank" class="detail-link">üìÖ Horarios</a>
                        <a href="https://es.cite-espace.com/visitar/donde-comer/" target="_blank" class="detail-link" style="background: var(--secondary);">üçΩÔ∏è Men√∫s</a>
                        <a href="tel:+33567222324" class="detail-link" style="background: var(--accent); color: #1e293b;">üìû 05 67 22 23 24</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- B√©tharram Detail Modal -->
    <div class="detail-modal" id="betharram-modal">
        <div class="detail-content">
            <div class="detail-header" style="background: linear-gradient(135deg, #14b8a6, #2dd4bf);">
                <h2>Grottes de B√©tharram</h2>
                <button class="detail-close" onclick="closeBetharramModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="detail-body">
                <div class="detail-section">
                    <h3>üíé Sobre las Grutas</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 12px;">Una de las primeras cuevas abiertas al p√∫blico (desde 1903). Recorrido espectacular de <strong>1h20 min</strong> con gu√≠a por 5 niveles de galer√≠as con estalactitas y estalagmitas, paseo en <strong>barca por el r√≠o subterr√°neo</strong> y 700m en <strong>petit train</strong> dentro de las grutas. Temperatura constante de 14¬∞C.</p>
                </div>
                <div class="detail-section">
                    <h3>üïê Horarios 2026</h3>
                    <ul class="detail-list">
                        <li><span class="label">9 Feb ‚Üí 6 Mar</span><span class="value">Lun-Vie: 14:00 - 16:30</span></li>
                        <li><span class="label">23 Mar ‚Üí 5 Jul</span><span class="value">9:30-12:00 y 13:30-16:30</span></li>
                        <li><span class="label">6 Jul ‚Üí 23 Ago</span><span class="value">9:00 - 18:00 (continuo)</span></li>
                        <li><span class="label">24 Ago ‚Üí 1 Nov</span><span class="value">9:30-12:00 y 13:30-16:30</span></li>
                    </ul>
                    <div style="margin-top: 10px; padding: 10px; background: rgba(20,184,166,0.1); border-radius: var(--radius-sm); font-size: 0.85rem; color: var(--text-secondary);">‚ö†Ô∏è Llegar <strong>30 min antes</strong> de la visita. Un autob√∫s lanzadera lleva a la entrada de las cuevas. <strong>Reservar online</strong> muy recomendable.</div>
                </div>
                <div class="detail-section">
                    <h3>üí∞ Precios</h3>
                    <div class="detail-grid">
                        <div class="detail-card"><h4>ADULTO</h4><div class="price">17‚Ç¨</div><p>Tarifa normal</p></div>
                        <div class="detail-card highlight"><h4>NI√ëO (4-12)</h4><div class="price">12‚Ç¨</div><p>De 4 a 12 a√±os</p></div>
                        <div class="detail-card"><h4>ADULTO REDUCIDA</h4><div class="price">15‚Ç¨</div><p>Con justificante</p></div>
                        <div class="detail-card"><h4>NI√ëO REDUCIDA</h4><div class="price">10,50‚Ç¨</div><p>4-12 a√±os con descuento</p></div>
                    </div>
                    <div style="margin-top: 12px; text-align: center;">
                        <a href="https://betharram.qweekle.com/shop/betharram?lang=en" target="_blank" class="detail-link" style="background: linear-gradient(135deg, #14b8a6, #2dd4bf);">üéüÔ∏è Comprar Entradas Online</a>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>‚è±Ô∏è Duraci√≥n y Experiencia</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div class="detail-card" style="border-left: 3px solid #14b8a6;">
                            <h4>üö∂ Recorrido a pie</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Visita guiada por 5 niveles de galer√≠as con formaciones calc√°reas espectaculares.</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid #3b82f6;">
                            <h4>üö£ Paseo en barca</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Navegaci√≥n por el r√≠o subterr√°neo en el interior de las grutas.</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid #f59e0b;">
                            <h4>üöÇ Petit Train (700m)</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Recorrido final en tren por las galer√≠as. ¬°Una experiencia √∫nica!</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid var(--text-muted);">
                            <h4>üå°Ô∏è Temperatura: 14¬∞C</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Constante todo el a√±o. Llevar chaqueta ligera. No se permiten cochecitos (hay escalones).</p>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üöó C√≥mo Llegar</h3>
                    <ul class="detail-list">
                        <li><span class="label">Direcci√≥n</span><span class="value">Chemin L√©on Ross, Saint-P√©-de-Bigorre</span></li>
                        <li><span class="label">Desde Lourdes</span><span class="value">~15 min en coche (14 km)</span></li>
                        <li><span class="label">Tel√©fono</span><span class="value">+33 5 62 41 80 04</span></li>
                    </ul>
                    <div style="margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <a href="https://maps.app.goo.gl/betharram" target="_blank" class="detail-link">üìç Ver en Google Maps</a>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üå§Ô∏è Tiempo en B√©tharram</h3>
                    <div class="detail-weather">
                        <div class="detail-weather-icon" id="betharram-weather-icon"><div class="loading-spinner"></div></div>
                        <div class="detail-weather-info">
                            <h4 id="betharram-temp">--¬∞C</h4>
                            <p id="betharram-condition">Cargando...</p>
                        </div>
                        <div style="margin-left: auto; text-align: right;">
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Viento: <span id="betharram-wind">-- km/h</span></p>
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Humedad: <span id="betharram-humidity">--%</span></p>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üîó Enlaces √ötiles</h3>
                    <div class="detail-links">
                        <a href="https://betharram.qweekle.com/shop/betharram?lang=en" target="_blank" class="detail-link" style="background: linear-gradient(135deg, #14b8a6, #2dd4bf);">üéüÔ∏è Reservar Visita</a>
                        <a href="https://www.betharram.com/pagina/horarios-y-precios" target="_blank" class="detail-link">üìÖ Horarios y Precios</a>
                        <a href="https://www.betharram.com/pagina/explore-nuestras-cuevas" target="_blank" class="detail-link" style="background: var(--secondary);">üî¶ Explorar las Cuevas</a>
                        <a href="tel:+33562418004" class="detail-link" style="background: var(--accent); color: #1e293b;">üìû 05 62 41 80 04</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pau Detail Modal -->
    <div class="detail-modal" id="pau-modal">
        <div class="detail-content">
            <div class="detail-header" style="background: linear-gradient(135deg, #ec4899, #f472b6);">
                <h2>Pau - Ch√¢teau de Pau</h2>
                <button class="detail-close" onclick="closePauModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="detail-body">
                <div class="detail-section">
                    <h3>üè∞ Ch√¢teau de Pau - Museo Nacional</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 12px;">Castillo donde naci√≥ <strong>Enrique IV de Francia</strong>. Museo nacional con mobiliario excepcional, tapices de los Gobelinos y colecci√≥n de arte. <strong>Vistas espectaculares</strong> de los Pirineos desde el Boulevard des Pyr√©n√©es. Parque y jardines abiertos todos los d√≠as.</p>
                </div>
                <div class="detail-section">
                    <h3>üïê Horarios</h3>
                    <ul class="detail-list">
                        <li><span class="label">Museo (todos los d√≠as)</span><span class="value">9:30-11:45 / 14:00-17:00</span></li>
                        <li><span class="label">√öltimo acceso</span><span class="value">16:45</span></li>
                        <li><span class="label">Parque y jardines</span><span class="value">8:00 - 18:15</span></li>
                        <li><span class="label">Visitas guiadas</span><span class="value">9:45 y 14:45 (reserva online)</span></li>
                    </ul>
                    <div style="margin-top: 10px; padding: 10px; background: rgba(236,72,153,0.1); border-radius: var(--radius-sm); font-size: 0.85rem; color: var(--text-secondary);">üá™üá∏ <strong>Visitas en espa√±ol</strong> disponibles en fechas especiales (puentes, festivos). Consultar agenda. App gratuita con audiogu√≠a en espa√±ol disponible.</div>
                </div>
                <div class="detail-section">
                    <h3>üí∞ Precios</h3>
                    <div class="detail-grid">
                        <div class="detail-card highlight"><h4>ADULTO</h4><div class="price">9‚Ç¨</div><p>Visita guiada</p></div>
                        <div class="detail-card"><h4>MENORES DE 26</h4><div class="price" style="color: var(--accent);">GRATIS</div><p>UE + residentes</p></div>
                        <div class="detail-card"><h4>PARQUE Y JARDINES</h4><div class="price" style="color: var(--accent);">GRATIS</div><p>Acceso libre</p></div>
                    </div>
                    <div style="margin-top: 12px; text-align: center;">
                        <a href="https://billetterie.museesnationaux-scn.grandpalaisrmn.fr/fr" target="_blank" class="detail-link" style="background: linear-gradient(135deg, #ec4899, #f472b6);">üéüÔ∏è Comprar Entradas Online</a>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üçΩÔ∏è D√≥nde Comer Cerca</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div class="detail-card" style="border-left: 3px solid #ec4899;">
                            <h4>üçΩÔ∏è Boulevard des Pyr√©n√©es</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Paseo panor√°mico con vistas a los Pirineos. Lleno de restaurantes, brasseries y caf√©s con terraza. A 2 min del castillo.</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid #f59e0b;">
                            <h4>üßÄ Mercado Les Halles de Pau</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Mercado cubierto con productos locales, quesos, jam√≥n de Bayona, foie gras y vinos del Jur√ßon. Puestos de comida para tapear.</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid #3b82f6;">
                            <h4>üè™ Rue du H√©das</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Calle peatonal gastron√≥mica en el casco antiguo. Restaurantes con cocina vasca-bearnesa y men√∫s del d√≠a asequibles.</p>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üöó C√≥mo Llegar</h3>
                    <ul class="detail-list">
                        <li><span class="label">Direcci√≥n</span><span class="value">Rue du Ch√¢teau, 64000 Pau</span></li>
                        <li><span class="label">Desde Lourdes</span><span class="value">~40 min en coche (45 km)</span></li>
                        <li><span class="label">Parking</span><span class="value">Parking Aragon (5 min a pie)</span></li>
                    </ul>
                </div>
                <div class="detail-section">
                    <h3>üå§Ô∏è Tiempo en Pau</h3>
                    <div class="detail-weather">
                        <div class="detail-weather-icon" id="pau-weather-icon"><div class="loading-spinner"></div></div>
                        <div class="detail-weather-info">
                            <h4 id="pau-temp">--¬∞C</h4>
                            <p id="pau-condition">Cargando...</p>
                        </div>
                        <div style="margin-left: auto; text-align: right;">
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Viento: <span id="pau-wind">-- km/h</span></p>
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Humedad: <span id="pau-humidity">--%</span></p>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üîó Enlaces √ötiles</h3>
                    <div class="detail-links">
                        <a href="https://chateau-pau.fr/agenda/evenement/visitas-del-castillo-en-espanol" target="_blank" class="detail-link" style="background: linear-gradient(135deg, #ec4899, #f472b6);">üá™üá∏ Visitas en Espa√±ol</a>
                        <a href="https://chateau-pau.fr/" target="_blank" class="detail-link">üè∞ Web Oficial</a>
                        <a href="https://billetterie.museesnationaux-scn.grandpalaisrmn.fr/fr" target="_blank" class="detail-link" style="background: var(--secondary);">üéüÔ∏è Entradas</a>
                        <a href="tel:+33559827000" class="detail-link" style="background: var(--accent); color: #1e293b;">üìû 05 59 82 70 00</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Biarritz Detail Modal -->
    <div class="detail-modal" id="biarritz-modal">
        <div class="detail-content">
            <div class="detail-header" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">
                <h2>Biarritz - Costa Vasca</h2>
                <button class="detail-close" onclick="closeBiarritzModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="detail-body">
                <div class="detail-section">
                    <h3>üèñÔ∏è Biarritz - Playa y Glamour</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 12px;">Ciudad costera elegante en el <strong>Pa√≠s Vasco franc√©s</strong>. Famosa por sus playas, su cultura del surf, el casino y el <strong>Rocher de la Vierge</strong>. Paseo mar√≠timo espectacular con vistas al Atl√°ntico. Ambiente sofisticado con historia de la Belle √âpoque.</p>
                </div>
                <div class="detail-section">
                    <h3>üÖøÔ∏è D√≥nde Aparcar</h3>
                    <div class="detail-card highlight" style="border-left: 3px solid #3b82f6;">
                        <h4>üÖøÔ∏è Parking Indigo Biarritz Casino</h4>
                        <p style="color: var(--text-secondary); margin-top: 4px;">Parking cubierto junto al <strong>Casino Municipal</strong> y la <strong>Grande Plage</strong>. Ubicaci√≥n c√©ntrica ideal para acceder a pie a las playas, el centro y el paseo mar√≠timo.</p>
                        <ul class="detail-list" style="margin-top: 8px;">
                            <li><span class="label">Direcci√≥n</span><span class="value">1 Avenue √âdouard VII, Biarritz</span></li>
                            <li><span class="label">Tipo</span><span class="value">Cubierto ¬∑ 24h</span></li>
                            <li><span class="label">A pie</span><span class="value">2 min Grande Plage ¬∑ 5 min Rocher de la Vierge</span></li>
                        </ul>
                        <div style="margin-top: 10px;">
                            <a href="https://maps.app.goo.gl/d1uBMSbgJP7xVUpJ7" target="_blank" class="detail-link" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">üìç Ver en Google Maps</a>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>‚≠ê Qu√© Ver</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div class="detail-card" style="border-left: 3px solid #3b82f6;">
                            <h4>ü™® Rocher de la Vierge</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Icono de Biarritz. Roca conectada al continente por una pasarela met√°lica dise√±ada por Eiffel. Vistas 360¬∞ al oc√©ano.</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid #f59e0b;">
                            <h4>üèñÔ∏è Grande Plage</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Playa principal de Biarritz. Arena fina, olas para surfistas y paseo bordeado de edificios Belle √âpoque.</p>
                        </div>
                        <div class="detail-card" style="border-left: 3px solid #ef4444;">
                            <h4>üé∞ Casino Municipal</h4>
                            <p style="color: var(--text-secondary); margin-top: 4px;">Edificio Art D√©co frente al mar. Restaurante, sala de espect√°culos y piscina exterior junto al parking.</p>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üå§Ô∏è Tiempo en Biarritz</h3>
                    <div class="detail-weather">
                        <div class="detail-weather-icon" id="biarritz-weather-icon"><div class="loading-spinner"></div></div>
                        <div class="detail-weather-info">
                            <h4 id="biarritz-temp">--¬∞C</h4>
                            <p id="biarritz-condition">Cargando...</p>
                        </div>
                        <div style="margin-left: auto; text-align: right;">
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Viento: <span id="biarritz-wind">-- km/h</span></p>
                            <p style="font-size: 0.85rem; color: var(--text-muted);">Humedad: <span id="biarritz-humidity">--%</span></p>
                        </div>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>üîó Enlaces √ötiles</h3>
                    <div class="detail-links">
                        <a href="https://maps.app.goo.gl/d1uBMSbgJP7xVUpJ7" target="_blank" class="detail-link" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">üÖøÔ∏è Parking Indigo Casino</a>
                        <a href="https://tourisme.biarritz.fr/es" target="_blank" class="detail-link">üèñÔ∏è Turismo Biarritz</a>
                        <a href="https://maps.app.goo.gl/biarritz" target="_blank" class="detail-link" style="background: var(--secondary);">üìç Google Maps</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        try { lucide.createIcons(); } catch(e) { console.warn('Lucide init:', e); }

        // === POI DATA ===
        const poiData = {
            guardo: {
                name: 'Guardo', coords: [42.7895455, -4.8462880],
                description: 'Municipio de Palencia, punto de partida hacia los Pirineos.',
                tag: 'Punto de Encuentro', icon: 'home', color: '#10b981'
            },
            biarritz: {
                name: 'Biarritz', coords: [43.4832, -1.5586],
                description: 'Elegante ciudad costera conocida por sus playas, surf y casino.',
                tag: 'Playa y Lujo', icon: 'waves', color: '#3b82f6'
            },
            lourdes: {
                name: 'Lourdes', coords: [43.0964, -0.0458],
                description: 'Importante lugar de peregrinaci√≥n cat√≥lica mundial. Gruta de Massabielle.',
                tag: 'Espiritualidad', icon: 'church', color: '#f59e0b'
            },
            cauterets: {
                name: 'Cauterets', coords: [42.8869, -0.1431],
                description: 'Estaci√≥n termal y de esqu√≠ en el Parque Nacional de los Pirineos.',
                tag: 'Naturaleza y Deporte', icon: 'mountain-snow', color: '#8b5cf6',
                pistas: { verde: 'Pistas f√°ciles', azul: 'Dificultad media', roja: 'Dif√≠ciles (Grand Barbat, Cr√™tes)', negra: 'Muy dif√≠ciles' },
                zonas: ['Snowpark', 'Zona luge', 'Zona d√©butant', 'Boardercross', 'Fun Line'],
                servicios: ['Restaurantes', 'Bares', 'Guarder√≠a', 'Primeros auxilios', 'Taquilla'],
                remontes: ['Telecabinas', 'Telesillas', 'Teleesqu√≠s', 'Cintas transportadoras']
            },
            betharram: {
                name: 'B√©tharram', coords: [43.0856, -0.2139],
                description: 'Grutas espectaculares con 1h20 de visita guiada: a pie, en barca y en tren subterr√°neo.',
                tag: 'Cuevas y Aventura', icon: 'gem', color: '#14b8a6'
            },
            toulouse: {
                name: 'Toulouse', coords: [43.5867, 1.4911],
                description: 'Cit√© de l\'Espace: parque tem√°tico del espacio con r√©plicas de cohetes y estaciones espaciales.',
                tag: 'Ciudad del Espacio', icon: 'rocket', color: '#ef4444'
            },
            pau: {
                name: 'Pau', coords: [43.2957547, -0.3685668],
                description: 'Ciudad hist√≥rica con castillo real, famosa por su boulevard de los Pirineos.',
                tag: 'Historia y Cultura', icon: 'landmark', color: '#ec4899'
            }
        };

        // === ROUTE DEFINITIONS ===
        const routeDefs = {
            'guardo-biarritz':   { from: 'guardo',  to: 'biarritz',  color: '#10b981', label: 'Guardo ‚Üí Biarritz' },
            'biarritz-lourdes':  { from: 'biarritz', to: 'lourdes',  color: '#3b82f6', label: 'Biarritz ‚Üí Lourdes' },
            'lourdes-cauterets': { from: 'lourdes',  to: 'cauterets', color: '#8b5cf6', label: 'Lourdes ‚Üí Cauterets' },
            'lourdes-toulouse':  { from: 'lourdes',  to: 'toulouse',  color: '#f59e0b', label: 'Lourdes ‚Üí Toulouse (Cit√© de l\'Espace)' },
            'lourdes-pau':       { from: 'lourdes',  to: 'pau',       color: '#ec4899', label: 'Lourdes ‚Üí Pau' }
        };

        const routeCache = {};

        // === MAP INIT ===
        const map = L.map('map', { center: [43.0, -1.0], zoom: 7, zoomControl: false });
        L.control.zoom({ position: 'bottomright' }).addTo(map);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO', subdomains: 'abcd', maxZoom: 19
        }).addTo(map);

        // === ICON HELPERS ===
        function getIconPath(icon) {
            const icons = {
                'home': '<path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"/><path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>',
                'waves': '<path d="M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/>',
                'landmark': '<line x1="3" x2="21" y1="22" y2="22"/><line x1="6" x2="6" y1="18" y2="11"/><line x1="10" x2="10" y1="18" y2="11"/><line x1="14" x2="14" y1="18" y2="11"/><line x1="18" x2="18" y1="18" y2="11"/><polygon points="12 2 20 7 4 7"/>',
                'church': '<path d="m18 7 4 2v11a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9l4-2"/><path d="M14 22v-4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v4"/><path d="M18 22V5l-6-3-6 3v17"/><path d="M12 7v5"/><path d="M10 9h4"/>',
                'mountain-snow': '<path d="m8 3 4 8 5-5 5 15H2L8 3z"/><path d="M4.14 15.08c2.62-1.57 5.24-1.43 7.86.42 2.74 1.94 5.49 2 8.23.19"/>',
                'rocket': '<path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/>',
                'gem': '<path d="M6 3h12l4 6-10 13L2 9Z"/><path d="M11 3 8 9l4 13 4-13-3-6"/><path d="M2 9h20"/>'
            };
            return icons[icon] || '';
        }

        function createCustomIcon(color, icon) {
            return L.divIcon({
                className: 'custom-div-icon',
                html: '<div class="custom-marker" style="background: linear-gradient(135deg, ' + color + ', ' + color + 'dd);"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">' + getIconPath(icon) + '</svg></div>',
                iconSize: [36, 36], iconAnchor: [18, 36], popupAnchor: [0, -36]
            });
        }

        // === ADD MARKERS ===
        const markers = {};
        Object.entries(poiData).forEach(function([key, poi]) {
            var marker = L.marker(poi.coords, { icon: createCustomIcon(poi.color, poi.icon) }).addTo(map);
            var popupHtml = '<div><h3><span style="color:' + poi.color + '">‚óè</span> ' + poi.name + '</h3><p>' + poi.description + '</p><span class="popup-tag">' + poi.tag + '</span>';
            if (poi.pistas) {
                popupHtml += '<div class="popup-details"><h4>Pistas</h4><div class="pistas-grid"><span class="pista">üü¢ ' + poi.pistas.verde + '</span><span class="pista">üîµ ' + poi.pistas.azul + '</span><span class="pista">üî¥ ' + poi.pistas.roja + '</span><span class="pista">‚ö´ ' + poi.pistas.negra + '</span></div></div>';
            }
            if (poi.zonas) {
                popupHtml += '<div class="popup-details"><h4>Zonas</h4><div class="zonas-list">' + poi.zonas.map(function(z) { return '<span class="zona-tag">' + z + '</span>'; }).join('') + '</div></div>';
            }
            popupHtml += '</div>';
            marker.bindPopup(popupHtml);
            markers[key] = marker;
        });

        // === ROUTE DRAWING ===
        var routePolylines = {};
        var highlightedRoute = null;
        var allRouteCoords = [];

        async function fetchRoadRoute(from, to) {
            var url = 'https://router.project-osrm.org/route/v1/driving/' + from[1] + ',' + from[0] + ';' + to[1] + ',' + to[0] + '?overview=full&geometries=geojson';
            var response = await fetch(url);
            var data = await response.json();
            if (data.routes && data.routes[0]) {
                var route = data.routes[0];
                return {
                    coords: route.geometry.coordinates.map(function(c) { return [c[1], c[0]]; }),
                    distance: route.distance,
                    duration: route.duration
                };
            }
            return { coords: [from, to], distance: 0, duration: 0 };
        }

        function formatDuration(seconds) {
            var h = Math.floor(seconds / 3600);
            var m = Math.round((seconds % 3600) / 60);
            if (h === 0) return m + ' min';
            return h + 'h ' + m + 'min';
        }

        async function drawAllRoutes() {
            var keys = Object.keys(routeDefs);
            for (var i = 0; i < keys.length; i++) {
                var key = keys[i];
                var def = routeDefs[key];
                try {
                    var fromCoords = poiData[def.from].coords;
                    var toCoords = poiData[def.to].coords;
                    var result = await fetchRoadRoute(fromCoords, toCoords);

                    routeCache[key] = {
                        coords: result.coords,
                        distance: result.distance,
                        duration: result.duration,
                        destCoords: toCoords,
                        destName: poiData[def.to].name
                    };

                    var polyline = L.polyline(result.coords, {
                        color: def.color, weight: 4, opacity: 0.7, smoothFactor: 1
                    }).addTo(map);
                    routePolylines[key] = polyline;
                    allRouteCoords = allRouteCoords.concat(result.coords);

                    var timeEl = document.getElementById('rt-' + key);
                    if (timeEl) {
                        var km = (result.distance / 1000).toFixed(0);
                        timeEl.textContent = km + ' km ¬∑ ' + formatDuration(result.duration);
                    }
                } catch (err) {
                    console.warn('Route ' + key + ' error:', err);
                }
            }
            if (allRouteCoords.length > 0) {
                map.fitBounds(L.latLngBounds(allRouteCoords), { padding: [50, 50] });
            }
        }

        // === ROUTE DETAIL (on click) ===
        var activeRouteKey = null;

        async function showRouteDetail(routeKey) {
            if (activeRouteKey === routeKey) { closeRouteDetail(); return; }
            activeRouteKey = routeKey;

            var def = routeDefs[routeKey];
            var panel = document.getElementById('route-detail-panel');
            var cached = routeCache[routeKey];

            // Highlight route item
            document.querySelectorAll('.route-item').forEach(function(el) { el.classList.remove('active'); });
            document.querySelector('[data-route="' + routeKey + '"]').classList.add('active');

            // Highlight polyline
            Object.keys(routePolylines).forEach(function(k) {
                routePolylines[k].setStyle({ weight: k === routeKey ? 7 : 3, opacity: k === routeKey ? 1 : 0.4 });
            });

            // Zoom to route
            if (cached) {
                map.fitBounds(L.latLngBounds(cached.coords), { padding: [80, 80] });
            }

            // Show panel
            panel.classList.add('visible');
            document.getElementById('rd-title').textContent = def.label;

            if (cached) {
                document.getElementById('rd-km').textContent = (cached.distance / 1000).toFixed(1) + ' km';
                document.getElementById('rd-time').textContent = formatDuration(cached.duration);
            } else {
                document.getElementById('rd-km').textContent = '...';
                document.getElementById('rd-time').textContent = '...';
            }

            // Fetch weather at destination
            document.getElementById('rd-weather-temp').textContent = '--¬∞';
            document.getElementById('rd-weather-desc').textContent = 'Cargando...';
            document.getElementById('rd-weather-icon').innerHTML = '<div class="loading-spinner" style="width:20px;height:20px;"></div>';

            var destCoords = poiData[def.to].coords;
            try {
                var resp = await fetch('https://api.open-meteo.com/v1/forecast?latitude=' + destCoords[0] + '&longitude=' + destCoords[1] + '&current=temperature_2m,weather_code&timezone=Europe/Paris');
                var data = await resp.json();
                if (data.current) {
                    document.getElementById('rd-weather-temp').textContent = Math.round(data.current.temperature_2m) + '¬∞C';
                    document.getElementById('rd-weather-desc').textContent = getWeatherDescription(data.current.weather_code);
                    document.getElementById('rd-weather-icon').innerHTML = getWeatherIcon(data.current.weather_code, 32);
                }
            } catch (e) {
                document.getElementById('rd-weather-desc').textContent = 'No disponible';
            }
        }

        function closeRouteDetail() {
            activeRouteKey = null;
            document.getElementById('route-detail-panel').classList.remove('visible');
            document.querySelectorAll('.route-item').forEach(function(el) { el.classList.remove('active'); });
            Object.keys(routePolylines).forEach(function(k) {
                routePolylines[k].setStyle({ weight: 4, opacity: 0.7 });
            });
        }

        // === FLY TO POI ===
        function flyToPOI(poiKey) {
            if (poiKey === 'biarritz') openBiarritzModal();
            if (poiKey === 'cauterets') openCauteretsModal();
            if (poiKey === 'toulouse') openToulouseModal();
            if (poiKey === 'betharram') openBetharramModal();
            if (poiKey === 'lourdes') openLourdesModal();
            if (poiKey === 'pau') openPauModal();
            var poi = poiData[poiKey];
            map.flyTo(poi.coords, 12, { duration: 1.5 });
            markers[poiKey].openPopup();
        }

        // === WEATHER (Lourdes) ===
        async function fetchWeather() {
            try {
                var lat = 43.0964;
                var lon = -0.0458;
                var response = await fetch(
                    'https://api.open-meteo.com/v1/forecast?latitude=' + lat + '&longitude=' + lon + '&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m&daily=temperature_2m_max,temperature_2m_min,weather_code&forecast_days=4&timezone=Europe/Paris'
                );
                var data = await response.json();

                if (data.current) {
                    var c = data.current;
                    document.getElementById('weather-temp').textContent = Math.round(c.temperature_2m) + '¬∞';
                    document.getElementById('weather-desc').textContent = getWeatherDescription(c.weather_code);
                    document.getElementById('weather-humidity').textContent = c.relative_humidity_2m + '%';
                    document.getElementById('weather-wind').textContent = Math.round(c.wind_speed_10m) + ' km/h';
                    document.getElementById('weather-feels').textContent = Math.round(c.apparent_temperature) + '¬∞';
                    document.getElementById('weather-icon').innerHTML = getWeatherIcon(c.weather_code, 48);
                }

                if (data.daily) {
                    var days = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
                    var forecastHtml = '';
                    for (var i = 1; i <= 3; i++) {
                        if (i < data.daily.time.length) {
                            var date = new Date(data.daily.time[i] + 'T00:00:00');
                            var dayName = days[date.getDay()];
                            var max = Math.round(data.daily.temperature_2m_max[i]);
                            var min = Math.round(data.daily.temperature_2m_min[i]);
                            var icon = getWeatherIcon(data.daily.weather_code[i], 28);
                            forecastHtml += '<div class="forecast-day"><div class="day-name">' + dayName + ' ' + date.getDate() + '</div><div class="day-icon">' + icon + '</div><div class="day-temps"><span class="day-max">' + max + '¬∞</span> <span class="day-min">' + min + '¬∞</span></div></div>';
                        }
                    }
                    document.getElementById('forecast-days').innerHTML = forecastHtml;
                }
            } catch (error) {
                console.error('Weather error:', error);
                document.getElementById('weather-desc').textContent = 'Error al cargar';
            }
        }

        // === WEATHER HELPERS ===
        function getWeatherDescription(code) {
            var d = {
                0:'Despejado', 1:'Mayormente despejado', 2:'Parcialmente nublado', 3:'Nublado',
                45:'Neblina', 48:'Neblina con escarcha',
                51:'Llovizna ligera', 53:'Llovizna moderada', 55:'Llovizna intensa',
                56:'Llovizna helada', 57:'Llovizna helada intensa',
                61:'Lluvia ligera', 63:'Lluvia moderada', 65:'Lluvia intensa',
                66:'Lluvia helada', 67:'Lluvia helada intensa',
                71:'Nevada ligera', 73:'Nevada moderada', 75:'Nevada intensa', 77:'Granizo fino',
                80:'Chubascos ligeros', 81:'Chubascos moderados', 82:'Chubascos intensos',
                85:'Nieve ligera', 86:'Nieve intensa',
                95:'Tormenta', 96:'Tormenta con granizo', 99:'Tormenta con granizo intenso'
            };
            return d[code] || 'Variable';
        }

        function getWeatherIcon(code, size) {
            size = size || 48;
            var type = 'sun';
            if (code === 0) type = 'sun';
            else if (code <= 2) type = 'cloud-sun';
            else if (code === 3) type = 'cloud';
            else if (code <= 48) type = 'cloud-fog';
            else if (code <= 57) type = 'cloud-drizzle';
            else if (code <= 67) type = 'cloud-rain';
            else if (code <= 77) type = 'cloud-snow';
            else if (code <= 82) type = 'cloud-rain';
            else if (code <= 86) type = 'cloud-snow';
            else if (code >= 95) type = 'cloud-lightning';

            var svgs = {
                'sun': '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M6.34 17.66l-1.41 1.41"/><path d="M19.07 4.93l-1.41 1.41"/></svg>',
                'cloud-sun': '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round"><path d="M12 2v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M20 12h2"/><path d="M19.07 4.93l-1.41 1.41"/><path d="M15.947 12.65a4 4 0 0 0-5.925-4.128"/><path d="M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z"/></svg>',
                'cloud': '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2" stroke-linecap="round"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/></svg>',
                'cloud-fog': '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2" stroke-linecap="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M16 17H7"/><path d="M17 21H9"/></svg>',
                'cloud-drizzle': '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24" fill="none" stroke="#60a5fa" stroke-width="2" stroke-linecap="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M8 19v1"/><path d="M8 14v1"/><path d="M16 19v1"/><path d="M16 14v1"/><path d="M12 21v1"/><path d="M12 16v1"/></svg>',
                'cloud-rain': '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M16 14v6"/><path d="M8 14v6"/><path d="M12 16v6"/></svg>',
                'cloud-snow': '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24" fill="none" stroke="#e2e8f0" stroke-width="2" stroke-linecap="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M8 15h.01"/><path d="M8 19h.01"/><path d="M12 17h.01"/><path d="M12 21h.01"/><path d="M16 15h.01"/><path d="M16 19h.01"/></svg>',
                'cloud-lightning': '<svg width="' + size + '" height="' + size + '" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round"><path d="M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973"/><path d="m13 12-3 5h4l-3 5"/></svg>'
            };
            return svgs[type] || svgs['sun'];
        }

        // === CAUTERETS MODAL ===
        function openCauteretsModal() {
            document.getElementById('cauterets-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
            fetchCauteretsWeather();
        }
        function closeCauteretsModal() {
            document.getElementById('cauterets-modal').classList.remove('active');
            document.body.style.overflow = '';
        }
        // === TOULOUSE MODAL ===
        function openToulouseModal() {
            document.getElementById('toulouse-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
            fetchToulouseWeather();
        }
        function closeToulouseModal() {
            document.getElementById('toulouse-modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function fetchToulouseWeather() {
            try {
                var resp = await fetch('https://api.open-meteo.com/v1/forecast?latitude=43.5867&longitude=1.4911&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&timezone=Europe/Paris');
                var data = await resp.json();
                if (data.current) {
                    document.getElementById('toulouse-temp').textContent = Math.round(data.current.temperature_2m) + '¬∞C';
                    document.getElementById('toulouse-condition').textContent = getWeatherDescription(data.current.weather_code);
                    document.getElementById('toulouse-wind').textContent = Math.round(data.current.wind_speed_10m) + ' km/h';
                    document.getElementById('toulouse-humidity').textContent = data.current.relative_humidity_2m + '%';
                    document.getElementById('toulouse-weather-icon').innerHTML = getWeatherIcon(data.current.weather_code, 40);
                }
            } catch (e) { console.error('Toulouse weather:', e); }
        }

        // === LOURDES MODAL ===
        function openLourdesModal() {
            document.getElementById('lourdes-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
            fetchLourdesModalWeather();
        }
        function closeLourdesModal() {
            document.getElementById('lourdes-modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function fetchLourdesModalWeather() {
            try {
                var resp = await fetch('https://api.open-meteo.com/v1/forecast?latitude=43.0964&longitude=-0.0458&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&timezone=Europe/Paris');
                var data = await resp.json();
                if (data.current) {
                    document.getElementById('lourdes-temp').textContent = Math.round(data.current.temperature_2m) + '¬∞C';
                    document.getElementById('lourdes-condition').textContent = getWeatherDescription(data.current.weather_code);
                    document.getElementById('lourdes-wind').textContent = Math.round(data.current.wind_speed_10m) + ' km/h';
                    document.getElementById('lourdes-humidity').textContent = data.current.relative_humidity_2m + '%';
                    document.getElementById('lourdes-weather-icon').innerHTML = getWeatherIcon(data.current.weather_code, 40);
                }
            } catch (e) { console.error('Lourdes modal weather:', e); }
        }

        // === B√âTHARRAM MODAL ===
        function openBetharramModal() {
            document.getElementById('betharram-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
            fetchBetharramWeather();
        }
        function closeBetharramModal() {
            document.getElementById('betharram-modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function fetchBetharramWeather() {
            try {
                var resp = await fetch('https://api.open-meteo.com/v1/forecast?latitude=43.0856&longitude=-0.2139&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&timezone=Europe/Paris');
                var data = await resp.json();
                if (data.current) {
                    document.getElementById('betharram-temp').textContent = Math.round(data.current.temperature_2m) + '¬∞C';
                    document.getElementById('betharram-condition').textContent = getWeatherDescription(data.current.weather_code);
                    document.getElementById('betharram-wind').textContent = Math.round(data.current.wind_speed_10m) + ' km/h';
                    document.getElementById('betharram-humidity').textContent = data.current.relative_humidity_2m + '%';
                    document.getElementById('betharram-weather-icon').innerHTML = getWeatherIcon(data.current.weather_code, 40);
                }
            } catch (e) { console.error('Betharram weather:', e); }
        }

        // === BIARRITZ MODAL ===
        function openBiarritzModal() {
            document.getElementById('biarritz-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
            fetchBiarritzWeather();
        }
        function closeBiarritzModal() {
            document.getElementById('biarritz-modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function fetchBiarritzWeather() {
            try {
                var resp = await fetch('https://api.open-meteo.com/v1/forecast?latitude=43.4832&longitude=-1.5586&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&timezone=Europe/Paris');
                var data = await resp.json();
                if (data.current) {
                    document.getElementById('biarritz-temp').textContent = Math.round(data.current.temperature_2m) + '¬∞C';
                    document.getElementById('biarritz-condition').textContent = getWeatherDescription(data.current.weather_code);
                    document.getElementById('biarritz-wind').textContent = Math.round(data.current.wind_speed_10m) + ' km/h';
                    document.getElementById('biarritz-humidity').textContent = data.current.relative_humidity_2m + '%';
                    document.getElementById('biarritz-weather-icon').innerHTML = getWeatherIcon(data.current.weather_code, 40);
                }
            } catch (e) { console.error('Biarritz weather:', e); }
        }

        // === PAU MODAL ===
        function openPauModal() {
            document.getElementById('pau-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
            fetchPauWeather();
        }
        function closePauModal() {
            document.getElementById('pau-modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function fetchPauWeather() {
            try {
                var resp = await fetch('https://api.open-meteo.com/v1/forecast?latitude=43.2958&longitude=-0.3686&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&timezone=Europe/Paris');
                var data = await resp.json();
                if (data.current) {
                    document.getElementById('pau-temp').textContent = Math.round(data.current.temperature_2m) + '¬∞C';
                    document.getElementById('pau-condition').textContent = getWeatherDescription(data.current.weather_code);
                    document.getElementById('pau-wind').textContent = Math.round(data.current.wind_speed_10m) + ' km/h';
                    document.getElementById('pau-humidity').textContent = data.current.relative_humidity_2m + '%';
                    document.getElementById('pau-weather-icon').innerHTML = getWeatherIcon(data.current.weather_code, 40);
                }
            } catch (e) { console.error('Pau weather:', e); }
        }

        // === MODAL CLOSE HANDLERS ===
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('detail-modal')) {
                closeBiarritzModal();
                closeCauteretsModal();
                closeToulouseModal();
                closeBetharramModal();
                closeLourdesModal();
                closePauModal();
            }
        });
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeBiarritzModal();
                closeCauteretsModal();
                closeToulouseModal();
                closeBetharramModal();
                closeLourdesModal();
                closePauModal();
            }
        });

        async function fetchCauteretsWeather() {
            try {
                var resp = await fetch('https://api.open-meteo.com/v1/forecast?latitude=42.8869&longitude=-0.1431&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&timezone=Europe/Paris');
                var data = await resp.json();
                if (data.current) {
                    document.getElementById('cauterets-temp').textContent = Math.round(data.current.temperature_2m) + '¬∞C';
                    document.getElementById('cauterets-condition').textContent = getWeatherDescription(data.current.weather_code);
                    document.getElementById('cauterets-wind').textContent = Math.round(data.current.wind_speed_10m) + ' km/h';
                    document.getElementById('cauterets-humidity').textContent = data.current.relative_humidity_2m + '%';
                    document.getElementById('cauterets-weather-icon').innerHTML = getWeatherIcon(data.current.weather_code, 40);
                }
            } catch (e) { console.error('Cauterets weather:', e); }
        }

        // === INIT ===
        fetchWeather();
        setInterval(fetchWeather, 300000);
        drawAllRoutes().catch(function(err) { console.warn('Routes error:', err); });
    </script>
</body>
</html>
